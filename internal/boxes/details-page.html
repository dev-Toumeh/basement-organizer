{{ define "box-details-page" }}
{{ template "open-html-tag" . }} 
{{ template "head" . }}
<body>
    {{ template "navbar" . }}
    {{ template "notification-container" . }}
    {{ template "box-details-page-content" . }}
</body>
{{ template "close-html-tag" . }}
{{end}} 


{{ define "box-details-page-content"  }}
<h1>Box details</h1>
    {{ if .NotFound }}
        <p>Box "{{.ID}}" doesn't exist.</p>
        <br>
        <p style="text-align: center">:^(</p>
    {{ else }}
        {{ template "box-details" . }}
        <div id="place-holder"></div>
        <h2>Items</h2>
        {{ template "item-list" . }}
        <h2>Inner Boxes</h2>
        {{ template "innerboxes-list" . }}
    {{ end }}
{{ end }}


{{ define "box-details" }}
<form id="box-{{.ID}}"
    class="box-container"
    hx-encoding="multipart/form-data">
    <div class="box-info-container">
        <div class="box-detail-info">
            <label for="id">ID:</label>
            <input name="id" type="text" value="{{.ID}}" {{ if not .Edit}}disabled{{end}}>

            <label for="label">Label:</label>
            <input name="label" type="text" value="{{.Label}}" {{ if not .Edit}}disabled{{end}}>

            <label for="description">Description:</label>
            <input name="description" type="text" value="{{.Description}}" {{ if not .Edit}}disabled{{end}}>

            <label for="qrcode">QRCode:</label>
            <input type="text" id="qrcode" name="qrcode" value="{{ .QRCode }}" {{ if not .Edit}}disabled{{end}}>
            <br>

            <label for="box_id">Is inside box:</label>
            {{ if eq .OuterBoxID.String "00000000-0000-0000-0000-000000000000" }}
                <span id="outerbox-link">None</span>
            {{ else }}
                <a id="outerbox-link" href="/box/{{.OuterBoxID}}" 
                    class="clickable"
                    hx-boost="true"
                >{{ .OuterBox.Label }}</a>
            {{ end }}
            <input type="text" id="box_id" name="box_id" value="{{ .OuterBoxID }}" readonly>
            <button id="move-btn"
                hx-post="/box/{{.ID}}/moveto/box"
                hx-target="#place-holder"
                hx-push-url="false"
                {{ if not .Edit }}disabled{{ end }}
            >Move to another box</button>
            <br>

            <label for="shelf_id">Is inside shelf:</label>
            {{ if eq .ShelfID.String "00000000-0000-0000-0000-000000000000" }}
                <span id="shelf-link">None</span>
            {{ else }}
                <a id="shelf-link" href="/shelves/{{.ShelfID}}" 
                    class="clickable"
                    hx-boost="true"
                >{{ .ShelfID }}</a>
            {{ end }}
            <input type="text" id="shelf_id" name="shelf_id" value="{{ .ShelfID }}" readonly>
            <button id="move-btn"
                hx-post="/box/{{.ID}}/moveto/shelf"
                hx-target="#place-holder"
                hx-push-url="false"
                {{ if not .Edit }}disabled{{ end }}
            >Move to shelf</button>
            <br>
        </div>

        <div id="image-preview-{{ .ID }}" class="box-detail-picture">
            {{ if .Picture }}
            <label for="picture">Picture:</label>
            <img class="detail" src="data:image/png;base64,{{ .Picture }}" alt="{{ .Label }}">
            {{ else }}
            <p>No image available</p>
            {{ end }}

            {{ if .Edit }}
            <input type="file" id="picture-{{ .ID }}" name="picture" accept="image/*" >
            {{ else }}
            <input type="file" id="picture-{{ .ID }}" name="picture" accept="image/*" disabled>
            {{ end }}
        </div>
    </div>  


{{ if .EnvDevelopment }}
<div style="outline:solid;font-size:0.7rem" class="background-diagonal-stripes">
    <div>Development info</div>
    <div>API data: /api/v1/box/{{.ID}}</div>
    <p hx-trigger="load" hx-get="/api/v1/box/{{.ID}}" style="overflow:scroll"></p>
    <div>preview picture
        <img class="detail" src="data:image/png;base64,{{ .PreviewPicture }}">
    </div>
</div>
{{ end }}



{{ if .Edit }}
<button hx-put="/box" 
        hx-target="#box-{{.ID}}"
        hx-swap="outerHTML"
>Update box</button>
<button hx-get="/box?id={{.ID}}"
        hx-target="#box-{{.ID}}"
        hx-swap="outerHTML"
>cancel</button>
{{ else }}
<button hx-get="/box?id={{.ID}}&edit=true"
        hx-target="#box-{{.ID}}"
        hx-swap="outerHTML"
>edit</button>
{{ end }}

<button hx-delete="/box?id={{.ID}}" 
        hx-swap="outerHTML"
        hx-target="#box-{{.ID}}"
        hx-confirm="Are you sure?"
>delete</button>

</form>
{{end}}


{{ define "empty-list" }}
<form id="inner-boxes-list"
    hx-get="/box"
    hx-push-url="true"
    hx-target="body"
    hx-swap="outerHTML"
    hx-trigger="keyup changed delay:500ms from:#search-bar, keyup changed delay:500ms from:#item-limit"
>
    <table class="box-list">
        <thead>
            <tr>
                <th>Label</th>
                <th>Box</th>
                <th>Shelf</th>
                <th>Area</th>
                <th style="width: 10%">Image</th>
                <th style="width: 10%">Move</th>
                {{ if not .Move }}
                <th style="width: 10%">Delete</th>
                {{ end }}
            </tr>
        </thead> 
        <tbody id="box-list-body">
            <tr id="box-list-row-{{.ID}}">
                <td colspan="7" style="text-align:center">No Entries</td>  
            </tr>
        </tbody>
    </table>
    <div >
        <button hx-delete="/boxes"
            hx-target="#box-list"
            hx-select="#box-list"
            hx-push-url="true"
            disabled
        >delete</button>
        <button type="button" 
            hx-get="/boxes/move"
            disabled
        >move</button>
    </div>
</form>
{{ end }}


{{ define "innerboxes-list" }}
<form id="inner-boxes-list"
    hx-get="/box"
    hx-push-url="true"
    hx-target="body"
    hx-swap="outerHTML"
    hx-trigger="keyup changed delay:500ms from:#search-bar, keyup changed delay:500ms from:#item-limit"
>
    <table class="box-list">
        <thead>
            <tr>
                <th>Label</th>
                <th>Box</th>
                <th>Shelf</th>
                <th>Area</th>
                <th style="width: 10%">Image</th>
                <th style="width: 10%">Move</th>
                {{ if not .Move }}
                <th style="width: 10%">Delete</th>
                {{ end }}
            </tr>
        </thead> 
        <!--boxes are created directly by backend with template-->
        <tbody id="box-list-body">
        {{ if .InnerBoxes }}
            {{ range .InnerBoxes }}
            {{ template "box-list-row" . }}
            {{ end }}
        {{ else }}
            <tr id="box-list-row-{{.ID}}">
                <td colspan="7" style="text-align:center">No Entries</td>  
            </tr>
        {{ end }}
        </tbody>
    </table>
    <div >
        <button hx-delete="/boxes"
            hx-target="#box-list"
            hx-select="#box-list"
            hx-push-url="true"
        >delete</button>
        <button type="button" 
            hx-get="/boxes/move"
        >move</button>
    </div>
</form>

<div id="data-container" style="display: none;"></div> 
{{ end }}


{{ define "item-list" }}
<form id="item-list"
    hx-get="/box"
    hx-push-url="true"
    hx-target="body"
    hx-swap="outerHTML"
    hx-trigger="keyup changed delay:500ms from:#search-bar, keyup changed delay:500ms from:#item-limit"
>
    <table class="box-list">
        <thead>
            <tr>
                <th>Label</th>
                <th>Box</th>
                <th>Shelf</th>
                <th>Area</th>
                <th style="width: 10%">Image</th>
                <th style="width: 10%">Move</th>
                {{ if not .Move }}
                <th style="width: 10%">Delete</th>
                {{ end }}
            </tr>
        </thead> 
        <!--boxes are created directly by backend with template-->
        <tbody id="box-list-body">
        {{ if .ListRows }}
            {{ range .ListRows }}
            {{ template "item-list-row" . }}
            {{ end }}
        {{ else }}
            <tr id="empty-list-item">
                <td colspan="7" style="text-align:center">No Entries</td>  
            </tr>
        {{ end }}
        </tbody>
    </table>
    <div >
        <button hx-delete="/boxes"
            hx-target="#box-list"
            hx-select="#box-list"
            hx-push-url="true"
        >delete</button>
        <button type="button" 
            hx-get="/boxes/move"
        >move</button>
    </div>
</form>

<div id="data-container" style="display: none;"></div> 
{{ end }}


{{ define "item-list-row" }}
    {{ $empty := false }}
    {{ if not . }}
        {{ $empty = true }}
    {{ end }}

    {{ if $empty }}
    <tr id="box-list-row-{{.ID}}">
        <td colspan="7" style="text-align:center">
            <span class="empty">empty<img class="preview" style="opacity:0"></span>
        </td>  
    </tr>
    {{ else }}
    <tr id="item-list-row-{{.ID}}">
         <!--hx-get="/items/{{.ID}}"-->
        <td
            hx-get="/api/v1/read/item/{{.ID}}"
            hx-push-url="true"
            hx-target="#item-list"
            class="clickable"
        >{{.Label}}</td>
        <td>{{.BoxLabel}}</td> 
        <td>{{.ShelfLabel}}</td>
        <td>{{.AreaLabel}}</td>
        <td style="text-align: center;width:0;text-wrap: nowrap;">
            <div>
            <img class="preview" 
                src="data:image/png;base64,{{.PreviewPicture}}" 
                {{if .PreviewPicture}}alt="{{.Label}}"{{end}}
            >
            </div>
        </td>
        {{ if not .Move}}
        <td style="text-align: center;"><input type="checkbox" name="move:{{.ID}}"></td>
        <td style="text-align: center;"><input type="checkbox" name="delete:{{.ID}}"></td>
        {{ else }}
        <td style="text-align: center;">
            <button type="">move here</button>
        </td>
        {{ end }}
    </tr>
    {{ end }}
{{ end }}
