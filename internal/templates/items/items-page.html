{{ define "items-page" }}
{{ template "open-html-tag" .}}
{{ template "head" . }}
<body>
    {{ template "navbar" . }}
    {{ template "items-page-content" . }}
    {{ template "items-js" .}}
</body>
{{ template "close-html-tag" .}}
{{ end }}

{{ define "items-page-content" }}

<div id="main-container">
    <div class="section-up">
        <div class="quarter"> </div>
        <div class="three-quarters">
          {{ template "notification-container" . }}
        </div>
    </div>
    <div class="section-down">
        <div class="quarter">
        <ul>
            <li>
                <button
                    class="menu-button"
                    hx-get="/template/item-search"
                    type="button"
                    hx-swap="innerHTML"
                    hx-push-url="false"
                    hx-target=".target">
                    Search Items
                </button>
                <button 
                    class="menu-button"
                    hx-get="/template/item-form" 
                    type="button"
                    hx-swap="innerHTML"
                    hx-target=".target"
                    hx-push-url="false">
                    Add new Item
                </button>
                <button 
                    class="menu-button"
                    hx-post="/template/item-dummy" 
                    type="button"
                    hx-swap="none"
                    hx-target="this"
                    hx-push-url="false">
                    Add dummy Items
                </button>
            </li>
        </ul>
        </div>
        <div class="three-quarters target">
            <form id="box-list" style="display: block;"> 
                <label for="search">search Items</label>
                <input type="text"
                       hx-post="/api/v1/search/item"
                       hx-target="#item-list-body"
                       hx-trigger="focus, keyup changed delay:500ms"
                       hx-trigger="focus"
                       id="search-bar"
                       name="query">
                <table class="box-list">
                    <thead>
                        <tr>
                            <th>Label</th>
                            <th>Box</th>
                            <th>Shelve</th>
                            <th>Area</th>
                            <th style="width: 10%">Image</th>
                            <th style="width: 10%">Move</th>
                            <th style="width: 10%">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="item-list-body"> 
                    </tbody>
                </table>
                <button type="submit" hx-post="/delete-item" hx-swap="none">delete</button>
                <button type="submit" hx-post="/move-item">move</button>
            </form>
            <div id="data-container" style="display: none;"></div> 
        </div>
    </div>
</div>
{{end}}

{{ define "items-js" }}
    <script>
        function showForm() {
            document.getElementById('box-list').style.display = 'block';
            document.getElementById('data-container').style.display = 'none';
        }

        document.body.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target.id === 'data-container') {
                document.getElementById('box-list').style.display = 'none';
                document.getElementById('data-container').style.display = 'block';
            }
        });


        document.body.addEventListener('htmx:afterOnLoad', function(event) {
            handleDeleteRows(event);
        });

        function handleDeleteRows(event) {
            if (event.detail.successful) {
                const checkedCheckboxes = document.querySelectorAll('input.delete-checkbox:checked');
                checkedCheckboxes.forEach(checkbox => {
                    const rowToDelete = checkbox.closest('tr');
                    if (rowToDelete) {
                        rowToDelete.remove();
                    }
                });
            } else {
                console.error('Deletion failed:', event.detail);
            }
        }
        if (typeof buttons == 'undefined') {
          const buttons = document.querySelectorAll('.menu-button');

          buttons.forEach(button => {
            button.addEventListener('click', () => {
              if (!button.classList.contains('clicked')) { // Check if already clicked
                buttons.forEach(btn => btn.classList.remove('clicked'));
                button.classList.add('clicked');
              }
            });
          });
        }
    </script>
{{end}}




